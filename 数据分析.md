数据分析
=================
numpy
-------------------
### 导入
``` python
import numpy as np                                         # 行业习惯
```
### 数据类型（ndarray）
#### 创建数组
##### 创建一维数组
``` python
a1 = np.array([1, 2, 3, 4, 5, 6, 7, 8, 9])                 # 创建一维数组

b1 = arange(1, 16, 2)        # 创建以1开头，16结尾，不包括16，步长为2的一维数组

c1 = np.zeros(10)          # 创建一维零数组
d1 = np.ones(10)           # 创建一维一数组
e1 = np.empty(10)          # 创建一维数组，只分配内存空间，不填充任何数值
```
##### 创建二维数组
``` python
a2 = np.array([[1, 2, 3], [4, 5, 6], [7, 8, 9]])           # 创建二维数组

b2 = np.arange(1, 16, 2).reshape((4,2))                    # 将一维b1重新组成4行2列

c2 = np.zeros((3, 4))      # 创建二维零数组
d2 = np.ones((3, 4))       # 创建二维数组
e2 = np.empty((3, 4))      # 创建二维矩阵

f1 = np.eye(3)             # 创建二维单位矩阵
f2 = np.identity(3)        # 同上
```
##### 其他创建函数
``` python
c3 = np.zeros_like(c2)     # 创建和c2相同维度的数组
d3 = np.ones_like(d2)      # 创建和d2相同维度的数组
e3 = np.empty_like(f2)     # 创建和f2相同维度的数组
```
#### 数组属性访问
``` python
a1.ndim                    # 访问属性：维度(轴的个数)
a1.shape                   # 访问属性：轴长度（第一维轴长度，第二维轴长度，……）
a1.size                    # 访问属性：访问数组长度，即元素个数
a1.dtype                   # 访问属性：元素数据格式
```
#### 数据格式
##### 数据格式更改
``` python
a1 = np.array([1, 2, 3], dtype = np.float64)               # 创建时指定数据格式

a1.astype(np.int64)        # 显式地转换dtype，调用astype无论如何都会创建出一个新的数组，就算dtype相同也会
#将浮点数转换成整数，小数部分会被截断
```
##### 数据格式一览
Ｎumpy数据类型         |            类型代码        |         说明
---------------------| ----------------------------|--------------------------
int8   uint8 | i1  u1 | 有符号和无符号的8位（1个字节）整型
int16  uint16 | i2  u2 | 有符号和无符号的16位（2个字节）整型
int32  uint32 | i4  u4 | 有符号和无符号的32位（4个字节）整型
int64  uint64 | i8  u8 | 有符号和无符号的64位（8个字节）整型
float16 | f2 | 半精度浮点数
float32 | f4或f | 标准的单精度浮点数。与Ｃ的float兼容
float64 | f8或d | 标准的双精度浮点数。与Ｃ的double和Ｐython的float对象兼容
float128 | f16或g | 扩展精度浮点数
complex64 complex128 | c8 c16 | 分别用两个32位、64位或128位浮点数表示的复数
bool | ? | 存储Ｔrue和Ｆalse值的布尔类型
object | Ｏ | Ｐython对象类型
string_ | Ｓ | 固定长度的字符串类型（每个字符1个字节），例如要创建一个长度为10的字符串，应使用Ｓ10
unicode_ | Ｕ | 固定长度的unicode类型（字节数由平台决定）。跟字符串的定义方式一样（Ｕ10）


#### 索引和切片
##### 一维数组索引和切片
``` python
a1[0]                      # 一维数组索引，从0开始
a1[0:2]                    # 一维切片，前闭后开
```
##### 多维数组索引和切片
``` python
a2[0][0]                   # 多维递归索引
a2[0, 0]                   # 多维直接访问

# 返回相同维度的数组视图
s1 = a2[0:2][0:2]          # 多维递归切片
s1 = a2[0:2, 0:2]          # 多维直接切片
s1                         # --> array([[1, 2], 
                                        [4, 5]])
a2.ndim                    # --> 2                                        
s1.ndim                    # --> 2

s2 = a2[2:, :]             # 前后都是切片
s2                         # --> array([[7, 8, 9]])，注意有两个中括号
s2.ndim                    # --> 2，还是二维的
# 返回低一个维度的数组
s3 = a2[2]                 # 多维数组，省略索引
s3.ndim                    # --> 1
s4 = a2[2, :]              # 前后只有一个逗号
s4.ndim                    # --> 1
```
##### 切片是视图
``` python
# 数组切片是原始数据的视图，
# 这意味着，数据不会被复制，视图上的任何修改都会直接反映到原始数据上
as = a1[3:6]               # --> 4,5,6（视图）
as[0] = 0                  # --> 0,5,6（视图）
a                          # --> 1,2,3,0,5,6,7,8,9（原始数据--改变）

# 如果你想得到切片的一个副本而不是视图，需要显式地用copy()方法进行复制
a = np.array([1,2,3,4,5,6,7,8,9])
a_s = a[3:6].copy()        # --> 4,5,6（副本）
a_s[0] = 0                 # --> 0,5,6（副本）
a                          # --> 1,2,3,4,5,6,7,8,9（原始数据--没变）
```
##### bool索引 ------ (副本)
对数组作比较运算，会返回一个相同维度的bool数组，符合条件的返回Ｔrue，否则返回Ｆalse
``` python
a2[a2>5]                   # --> array([6, 7, 8, 9])

row = [1, 0, 1]
a2[row == 1]               # --> array([1, 2, 3], 
                                       [7, 8, 9])
a2[-(row == 1)]            # 要选择不等于除了!=（不等于号）还可以用-（负号）
```
bool索引可以和索引切片一起使用
``` python
a2[row == 1, 1]            # --> array([2, 8])
a2[row == 1, 1:]           # --> array([2, 3], 
                                       [8, 9])
```
选择多个条件，需要逻辑运算
``` python
a2[(row == 1) | (row == 0)]# -->array([[1, 2, 3], 
                                       [4, 5, 6], 
                                       [7, 8, 9]])
# Python关键字and和or在bool数组中无效
```

##### 花式索引 ------ (副本)
利用整数数组以特定顺序进行索引
``` python
a2[[2, 0, 1]]              # --> array([[7, 8, 9], 
                                        [1, 2, 3], 
                                        [4, 5, 6]])
a2[[-1, -2, -3]]           # --> array([[7, 8, 9], 
                                        [4, 5, 6], 
                                        [1, 2, 3]])
```
传入多个索引数组，会返回一个一维数组，对应索引
``` python
a2[[1, 2], [2, 0]]         # --> array([6, 7])
# 最终选取的是（1, 2）（2, 0）两个元素
```
选取矩阵子列
``` python
# 方法一：先按特定顺序排序选出行，再索引全部行，再按特定顺序选取列
a[[1, 2]],[:, [2, 0]]      # --> array([[6, 4], 
                                        [9, 7]])

# 方法二：使用np.ix_函数，它可以将两个一维数组转换成一个用于选取方形区域的索引器
a[np.ix_([1, 2], [2, 0])]  # --> array([[6, 4], 
                                        [9, 7]])
```

#### 运算
##### 算数运算
维度相等的数组之间的任何算数运算，都会将运算应用到元素级  
加减乘除乘方 + - * / **  
数组和标量之间的算术运算也会将那个标量值”传播“到各个元素  
加减乘除乘方 + - * / **  

##### 比较运算
返回bool数组：> < >= <= == !=

##### 线性代数
计算内积
``` python
np.dot(a2.T, a2)
```
转置 ------ (视图)
``` python
a2.T
a2.transpose()
swapaxes((1,2))
```

### 通用函数（ufunc）
通用函数，是一种对ndarray中的数据进行“元素级”运算的函数  

|一元函数 | 说明|
|--- | -----|  
|abs、fabs | 计算整数、浮点数或复数的绝对值。对于非复数值，可以使用更快的fabs|
|sqrt      | 计算各元素的平方根。相当于a ** 0.5|
|square    | 计算各元素的平方。相当于a ** 2|
|exp       | 计算各元素的指数e ^ x|
|log、log10、log2、log1p | 分别为自然对数（底数为e）、底数为10的log、底数为2的log、log(1 + x)|
|sign      | 计算各元素的正负号：1（正数）、0（零）、-1（负数）|
|ceil      | 计算各元素的ceiling值，即大于等于该值的最小整数|
|floor     | 计算各元素的floor值，即小于等于该值的最大整数|
|rint      | 将各元素值四舍五入到最接近的整数，保留dtype|
|modf      | 将数组的小数和整数部分以两个独立数组的形式返回|
|isnan     | 返回一个表示“哪些值是NaN（not a number）”的bool数组|
|isfinite、isinf | 分别返回一个表示“哪些元素是无穷的（非inf，非NaN）”或“哪些元素是无穷的”的bool数组|
|cos、cosh、sin、sinh、tan、tanh | 普通型和双曲线型三角函数|
|arccos、arccosh、arcsin、arcsinh、arctan、arctanh | 反三角函数|
|logical_not | 计算各元素的notx的真值。相当于-arr|

|二元函数|说明|
|---|---|
|add|将数组中对应的元素相加|
|subtract|从第一个数组中减去第二个数组中的元素|
|multiply|数组元素相乘|
|divide、floor_divide|除法或向下圆整除法（丢弃余数）|
|power|对第一个数组中的元素A，根据第二个数组中的相应元素B，计算A ^ B|
|maximum、fmax|元素级的最大值计算。fmax将忽略NaN|
|minimum、fmin|元素级的最小值计算。fmin将忽略NaN|
|mod|元素级的求模计算（除法的余数）|
|copysign|将第二个数组中的值的符号复制给第一个数组中的值|
|greater、greater_equal、less、less_equal、equal、not_equal|执行元素级的比较运算，最终产生bool数组。相当于中缀运算符>、>=、<、<=、==、!=|
|logical_and、logical_or、logicalxor|执行元素级的真值逻辑运算。相当于中缀运算符&、|、^|

### 数据处理
#### 将条件逻辑表述为数组运算 ------ /类似于：条件索引赋值/
`np.where()`函数，第一个参数为bool数组，如果为True变为第二个参数，如果为False变为第三个参数
第二第三个参数可以为数组或标量，数组的话大小可以不相等
``` python
np.where(a2 > 3, 0, -1)    # --> array([[-1, -1, -1], 
                                        [0, 0, 0], 
                                        [0, 0, 0]])
```
更复杂的逻辑：
假设有两个bool类型数组cond1和cond2
``` python
np.where(cond1 & cond2), 0,                                # 如果cond1和cond2都为True，则为0
            np.where(cond1, 1,                             # 如果只有cond1为True，则为1
               np.where(cond2, 2, 3)))                     # 如果只有cond2为True，则为2, 都为False,则为3

# 可以利用“bool值在计算过程中可以被当作0或1处理”将上面的写成下面的式子
1 * （cond1 & -cond2） + 2 * （cond2 & -cond1） + 3 * -（cond1 | cond2）
```

#### 数学和统计方法
求和
``` python
a2.sum()                   # 全体元素求和
a2.sum(0)                  # 0--对列求和
a2.sum(axis = 1)           # axis参数，1--对行求和

np.sum(a2)                 # sum函数既是方法，也是numpy的函数
np.sum(a2, 0)
np.sum(a2, axis = 1)
```
求最值
``` python
a2.max()                   # 全体元素最大值
a2.max(0)                  # 0--列
a2.max(axis = 1)           # 1--行

np.min(a2)                 # 全体元素最小值
np.min(a2, 0)              # 0--列
np.min(a2, axis = 1)       # 1--行

a2.argmax()                # 全体元素最大值的个数索引
a2.argmax(0)               # 每列最大值的索引
a2.argmax(axis = 1)        # 每行最大值的索引

np.argmin(a2)
np.argmin(a2, 0)
np.argmin(a2, axis = 1)
```
平均值
``` python
a.mean()                   # 全体元素平均值
a.mean(0)                  # 0--列，1--行
np.mean(a2, axis = 1)      # axis名可缺省
```
方差
``` python
a.var()                    # 全体元素求方差
a.var(0)                   # 0--列，1--行
np.var(a2, axis = a)       # axis名可缺省
```
标准差
``` pthon
a.std()                    # 全体元素求标准差
a.std(0)                   # 0--列，1--行
np.std(a2, axis = 1)       # axis名可缺省
```
中值
``` pthon
a.median()                 # 全体元素求中值
a.median(0)                # 0--列，1--行
np.median(a2, axis = 1)    # axis名可缺省
```
累计和&累计积
``` python
a.cumsum()
a.cumsum(0)
np.cumsum(a2, 1)

a.cumprod()
a.cumprod(0)
np.cumprod(a2, axis = 1)
```
|方法|说明|
|---|---|
|sum|对数组中全部或某轴向的元素求和。零长度的数组的sum为0|
|mean|算术平均值。零长度的数组的mean为NaN|
|std、var|分别为标准差和方差，自由度可调|
|min、max|最大值和最小值|
|argmin、argmax|分别为最大和最小元素的索引|
|cumsum|所有元素的累计和|
|cumprod|所有元素的累计积|

#### 用于bool类型数组的方法
bool数组用上面的数学统计方法会被强制转换成1和0。因此sum经常被用来对bool类型数组中的True计数
``` python
（a2 > 3).sum()
```
另外还有两个方法：any和all
any用于测试数组中是否存在True
all用于检查数组是否全是True
这两个方法也能用于非bool数组，所有非0元素都会被当成True
``` python
b = np.array([True, False, True, False])
b.any()                    # --> True
b.all()                    # --> False
```

#### 排序
计算数组分位数最简单的方法是对其进行排序，然后选取特定位置的值
``` python
a1.sort()                  # 从小到大排序，轴向默认为行
a2.sort(0)                 # 二维需要提供轴向，0--列，1--行
a2.sort(1)                 # sort方法是改变原始数据

np.sort(a2)                # 默认对行排列
np.sort(a2, 0)             # 0--列，1--行
np.sort(a2, 1)             # sort()函数是创建副本
```
#### 唯一化以及其他的集合逻辑
`np.unique()`函数用于找出数组中的唯一值并返回已排序的结果
``` python

```
`np.in1d()`函数用于测试数组中的值在另一个数组中的是否存在
``` python

```
|集合函数|说明|
|---|---|
|unique(x)|计算x中的唯一元素，并返回有序结果|
|intersect1d(x, y)|计算x和y中的公共元素，并返回有序结果|
|union1d(x, y)|计算x和y的合集，并返回有序结果|
|in1d(x, y)|得到一个表示“x的元素是否包含于y”的bool数组|
|setdiff1d(x, y)|集合的差，即元素在x中且不在y中|
|setxor1d(x, y)|集合的对称差（异或），即存在于一个数组中但不同时存在于两个数组中的元素|

### 用于数组的文件输入输出
numpy能够读写磁盘上的文本数据或二进制数据
#### 将数组以二进制格式保存到磁盘



#### 存取文本文件

### 随机数生成

### 范例：随机漫步





numpy高级应用
------------------




pandas
-------------------




matplotlib
------------------






scipy
--------------------









